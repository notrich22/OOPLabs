@startuml
skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam shadowing true

' === ГРУППА: УПРАВЛЕНИЕ ИГРОЙ (ОСНОВА ЛАБЫ 3) ===
package "Game Loop & Persistence" {
    class Game {
        - int currentLevel
        - bool isRunning
        - Board board
        - Player player
        __
        + init()
        + run() : void
        + nextLevel() : void
        - processLevelUp() : void
        - checkGameOver() : bool
    }

    class SaveManager {
        + {static} saveGame(game : Game, file : string)
        + {static} loadGame(game : Game, file : string)
        - {static} computeStableHash(data : string) : size_t
    }
}

' === ГРУППА: ОБРАБОТКА ОШИБОК (НОВОЕ В ЛАБЕ 3) ===
package "Exception Handling" {
    class GameException
    class FileException extends GameException
    class SaveDataException extends GameException
    class CorruptedSaveException extends GameException
}

' === ГРУППА: ПРОГРЕССИЯ И МАГИЯ (ИЗМЕНЕНИЯ ЛАБЫ 3) ===
package "Progression System" {
    class Player {
        - SpellHand spellHand
        - int health
        + setHealth(int)
    }

    class SpellHand {
        + removeRandomHalf() : void
        + addSpell(spell)
    }

    interface ISpell {
        + {abstract} upgrade() : void
        + {abstract} getUpgradeInfo() : string
    }
    }

' === СВЯЗИ ===

' Game управляет процессом
Game *-- Player
Game ..> SaveManager : <<friend>> \nuses for save/load

' SaveManager использует исключения
SaveManager ..> GameException : throws

' Связи игрока с магией
Player *-- SpellHand
SpellHand o-- ISpell

@enduml